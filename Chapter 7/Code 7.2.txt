/**
*"LinkedProfileDetails" class contains the method
* to call the LinkedIn API to get the basic profile
* details of a LinkedIn account. 
*/
global class LinkedIn_Pro_Details_onRecord{

    webService static void details(id recordid) {    
        
        String endpoint  = LinkedIn_Custom_Setting__c.getInstance( 'LinkedIn Endpoint' ).Value__c;
/**
*HttpRequest and HttpResponse class methods
*are used to get the data 
*/  
        
        HttpRequest httpReq  = new HttpRequest();
        Http http            = new Http();
        HttpResponse httpRes = new HttPResponse();
        
        httpReq.setMethod( 'GET' );
        httpReq.setEndpoint( endpoint );
        
/** Make sure to replace the access token generated in 1st step with 
below mentioned token assigned to authorizationHeader string variable
**/
        String authorizationHeader = 'Bearer AQWqtD8sNPBKbufQJO373OZ_D-4NCvOBGfJIbi1i04NO4ITjr1gPZo34qYwnZIdT9_xOEugjUcq9RnQIoxNL-_cOM5W7NswmrFZQRukITU0KCmj-DPQLdk8oQuoH7JEZ67mCg2vP-EM-SaDRfetzBpGBbptJGXaE-ec9vMZX9GmPQ37f43XnlBej7iRuNJ-rBG5PEZjxH72LL-c9Hj5WlhfjpgDEEoEOmmqGm9ZygH_ExhCen6JQI9n3mFs5h72X6dyTU0Y0z2HTHWvvpg3gCwPTo62rQwtRWi-QMpUE_vj86ysj2TVm1ytyRmSZObrBXJZo4U4iHaGlOulmGDcM0WZoJt4e0g';
        httpReq.setHeader('Authorization', authorizationHeader);
        
        httpRes = http.send( httpReq );
        
        System.debug(httpRes.getBody());
        
        
JSONParser parser = JSON.createParser(httpRes.getBody()); 
   string firstname= '';
   string lastname= '';
   string Headline= '';
   string proURL= '';   
   
        while (parser.nextToken() != null) {
            if ((parser.getCurrentToken() == JSONToken.FIELD_NAME) && 
                (parser.getText() == 'firstName')) {
                // Get the value.
                parser.nextToken();                
                firstname = parser.gettext();
                
                system.debug('firstname --------------------- '+ firstname);             
            }
            
            if ((parser.getCurrentToken() == JSONToken.FIELD_NAME) && 
                (parser.getText() == 'lastName')) {
                // Get the value.
                parser.nextToken();                
                lastname= parser.gettext();
                system.debug('lastname--------------------- '+ lastname);
            }
            if ((parser.getCurrentToken() == JSONToken.FIELD_NAME) && 
                (parser.getText() == 'headline')) {
                // Get the value.
                parser.nextToken();                
                Headline= parser.gettext();
                system.debug('Headline--------------------- '+ Headline);
            }
            if ((parser.getCurrentToken() == JSONToken.FIELD_NAME) && 
                (parser.getText() == 'url')) {
                // Get the value.
                parser.nextToken();                
                proURL= parser.gettext();
                
            }
        }                       
  
  
 //update the existing record with the facebook profile info as follows
    LinkedIn_info__c LI = new LinkedIn_info__c();   
    LI.First_Name__c= firstname;
    LI.Headline__c= Headline;
    LI.Last_Name__c= lastname;
    LI.Profile_URL__c= proURL;
            
    LI.id = recordid;
    update LI;   

    }                                                                  
}